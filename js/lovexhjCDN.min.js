function unlockPage(){if(!lock1||!lock2||!lock3)return;let e=document.querySelector(".lovexhjLoading");e.style.animation="unlock 1s ease-in-out forwards",setTimeout(()=>{e.style.display="none"},1e3)}let lock1=!1,lock2=!1,lock3=!1;window.onload=function(){lock1=!0,unlockPage()};const lovexhj=new Vue({el:"#lovexhj",data:()=>({localConfig:null,jsonConfig:null,wdnmdData:null,wdnmdIndex:0,wdnmdGo:!0,title:"",body:"",wdnmdLoading:!1,pswForm:!1,password:"",loadMore:!1}),mounted(){this.getLocalConfig(),this.getJsonConfig()},methods:{getLocalConfig(){this.localConfig=JSON.parse(window.localStorage.getItem("lovexhj")),this.localConfig||(window.localStorage.setItem("lovexhj",JSON.stringify({theme:"light"})),this.localConfig=JSON.parse(window.localStorage.getItem("lovexhj"))),lock2=!0,unlockPage(),this.loadTheme()},getJsonConfig(){let e="https://lovexhj.oss-cn-beijing.aliyuncs.com/heng/config/lovexhj.json",o=new XMLHttpRequest;o.open("get",e),o.send(null),o.onload=(()=>{200==o.status&&(this.jsonConfig=JSON.parse(o.responseText),setTimeout(()=>{lock3=!0,unlockPage(),this.getWdnmd(),this.createEditor(),this.pageLoadNum=this.jsonConfig.lovexhj.pageloadNum[1]},0))})},loadTheme(){let e={white:[["--bg-color","rgb(241, 242, 246)"],["--font-color","black"],["--load","rgba(211, 211, 211, 0.6)"]],dark:[["--bg-color","rgb(40, 44, 52)"],["--font-color","white"],["--load","rgba(0, 0, 0, 0.6)"]]},o=[];o="light"==this.localConfig.theme?e.white:e.dark,o.forEach(e=>{document.documentElement.style.setProperty(e[0],e[1])})},checkTheme(){"light"==this.localConfig.theme?this.localConfig.theme="dark":this.localConfig.theme="light",this.saveLocalConfig(),this.loadTheme()},saveLocalConfig(){window.localStorage.setItem("lovexhj",JSON.stringify(this.localConfig))},fmOpen(){let e=document.querySelector(".lovexhjBookFm");if(e.className.includes("lovexhjBookActive"))return e.classList.remove("lovexhjBookActive");e.classList.add("lovexhjBookActive")},getWdnmd(e){axios.get(`${this.jsonConfig.lovexhj.ServerBase}/get?page=${this.jsonConfig.lovexhj.pageloadNum[0]}&per_page=${this.jsonConfig.lovexhj.pageloadNum[1]}`).then(o=>{if(o.data.error)return console.log(o.data.error);if(0!=o.data.data.length){this.wdnmdData=e?this.wdnmdData.concat(o.data.data):o.data.data;for(let e=0;e<this.wdnmdData.length;e++)this.wdnmdData[e].created_at=new Date(this.wdnmdData[e].created_at).toLocaleDateString();o.data.data.length<this.jsonConfig.lovexhj.pageloadNum[1]&&(this.loadMore=!0)}},e=>{console.log(e)})},selectWdnmd(e){setTimeout(()=>{let e=window.Viewer,o=document.querySelectorAll(".lovexhjBookListContext img");o.forEach(o=>{new e(o)})},0),this.wdnmdIndex=e,this.ListOpen()},ListOpen(){let e=document.querySelector(".lovexhjBookList");if(e.className.includes("lovexhjBookActive"))return e.classList.remove("lovexhjBookActive"),document.querySelector(".lovexhjBookListBg").classList.remove("lovexhjBookActive","lovexhjBookListBgActive");e.classList.add("lovexhjBookActive"),document.querySelector(".lovexhjBookListBg").classList.add("lovexhjBookActive","lovexhjBookListBgActive")},move(){let e=document.querySelector(".lovexhjBookMove");this.wdnmdGo?e.style.transform="translateX(-50%)":e.style.transform="translateX(0%)",this.wdnmdGo=!this.wdnmdGo},createEditor(){let e=window.wangEditor,o=new e("#ed");o.config.menus=["head","bold","italic","underline","strikeThrough","link","list","justify","quote","emoticon","image","video","table","splitLine","undo","redo"],o.config.pasteFilterStyle=!1,o.highlight=this.hljs,o.config.placeholder=this.jsonConfig.lovexhj.editText,o.config.onchange=(e=>{this.body=e}),o.config.height=200,o.create();let t=document.querySelector(".w-e-toolbar"),s=document.querySelector(".w-e-text-container");t.style.background="transparent",t.style.borderWidth="0",s.style.background="transparent",s.style.border="transparent"},wdnmdSubmit(){return this.password?(this.wdnmdLoading=!0,this.title||this.body?void axios.post(this.jsonConfig.lovexhj.ServerBase+"/add",{title:this.title,body:this.body,password:this.password}).then(e=>{if(this.wdnmdLoading=!1,e.data.error)return this.$message({message:e.data.error,showClose:!0,type:"warning"});"ok"==e.data.data&&(this.$message({message:this.jsonConfig.lovexhj.wdnmdOk,showClose:!0,type:"success"}),this.getWdnmd())},e=>{console.log(e)}):(this.wdnmdLoading=!1,this.$message({message:"记仇也需要认真填写哦！",showClose:!0,type:"warning"}))):this.pswForm=!0},setPsw(e){this.pswForm=!1,e&&this.password&&this.$message({message:this.jsonConfig.lovexhj.passwordSetOk,showClose:!0,type:"success"})},lazyLoadList(){this.jsonConfig.lovexhj.pageloadNum[0]++,this.getWdnmd(!0)}}});